## **Core Concepts Overview**

**Scalability Definition:**
- **Scalability** = ability of an application/system to handle greater loads by adapting
- **Two types of scalability:**
  - Vertical Scalability (Scale Up/Down)
  - Horizontal Scalability (Scale Out/In) = Elasticity
- **Scalability is linked but different from High Availability**

**High Availability Definition:**
- Running application/system in **at least 2 data centers (Availability Zones)**
- **Goal:** Survive a data center loss
- Usually goes hand-in-hand with horizontal scaling
- Can be **passive** (RDS Multi-AZ) or **active** (horizontal scaling)

## **Types of Scalability**

### **Vertical Scalability (Scale Up/Down)**

**Characteristics:**
- **Increasing the size of the instance**
- Example: t2.micro → t2.large
- Common for **non-distributed systems** (databases)
- Services that scale vertically: **RDS, ElastiCache**
- **Hardware limit** exists for vertical scaling

**EC2 Vertical Scaling Range:**
- **From:** t2.nano (0.5G RAM, 1 vCPU)
- **To:** u-12tb1.metal (12.3 TB RAM, 448 vCPUs)

### **Horizontal Scalability (Scale Out/In)**

**Characteristics:**
- **Increasing number of instances/systems**
- Implies **distributed systems**
- Very common for **web applications/modern applications**
- Easy to scale horizontally with cloud offerings (Amazon EC2)
- **AWS Tools:** Auto Scaling Group, Load Balancer

## **High Availability & Scalability for EC2**

**Implementation Methods:**
- **Vertical Scaling:** Increase instance size
- **Horizontal Scaling:** Increase number of instances via ASG & Load Balancer
- **High Availability:** Run instances across multiple AZs via ASG multi-AZ & Load Balancer multi-AZ

## **Load Balancing**

### **What is Load Balancing?**
- **Servers that forward traffic to multiple downstream servers** (EC2 instances)
- Distributes incoming requests across multiple targets

### **Why Use Load Balancers?**

**Key Benefits:**
- **Spread load** across multiple downstream instances
- **Expose single point of access** (DNS) to application
- **Seamlessly handle failures** of downstream instances
- **Regular health checks** to instances
- **Provide SSL termination** (HTTPS) for websites
- **Enforce stickiness** with cookies
- **High availability** across zones
- **Separate public traffic** from private traffic

### **Why Use Elastic Load Balancer?**

**AWS-Managed Benefits:**
- **Managed load balancer** - AWS guarantees it will work
- AWS handles: upgrades, maintenance, high availability
- **Few configuration knobs** - less complexity
- **Cost-effective** compared to self-managed solutions
- **Integrated with AWS services:**
  - EC2, Auto Scaling Groups, Amazon ECS
  - AWS Certificate Manager (ACM), CloudWatch
  - Route 53, AWS WAF, AWS Global Accelerator

## **Health Checks**

**Crucial for Load Balancers:**
- Enable load balancer to know if instances can reply to requests
- Performed on **specific port and route** (/health is common)
- **If response is not 200 (OK)** → instance is unhealthy
- **Protocol options:** HTTP, TCP, HTTPS

## **Types of AWS Load Balancers**

### **AWS has 4 kinds of managed Load Balancers:**

**1. Classic Load Balancer (CLB) - v1 (2009)**
- **Protocols:** HTTP, HTTPS, TCP, SSL (secure TCP)
- **Health checks:** TCP or HTTP based
- **Fixed hostname:** XXX.region.elb.amazonaws.com
- **SSL:** Support only one SSL certificate

**2. Application Load Balancer (ALB) - v2 (2016)**
- **Layer 7 (HTTP)** load balancer
- **Protocols:** HTTP, HTTPS, WebSocket
- **Support:** HTTP/2, redirects (HTTP to HTTPS)
- **Advanced routing capabilities**
- **SSL:** Multiple SSL certificates with SNI

**3. Network Load Balancer (NLB) - v2 (2017)**
- **Layer 4 (TCP/UDP)** load balancer
- **Protocols:** TCP, TLS (secure TCP), UDP
- **Performance:** Millions of requests per second
- **Latency:** ~100ms (vs 400ms for ALB)
- **Static IP:** One static IP per AZ + Elastic IP support
- **SSL:** Multiple SSL certificates with SNI
- **Not included in AWS free tier**

**4. Gateway Load Balancer (GWLB) - (2020)**
- **Layer 3 (Network layer)** - IP Protocol
- **Use case:** Deploy/scale 3rd party network virtual appliances
- **Functions:** Transparent Network Gateway + Load Balancer
- **Protocol:** GENEVE on port 6081
- **Applications:** Firewalls, Intrusion Detection, Deep Packet Inspection

### **Load Balancer Target Groups**

**ALB Target Groups:**
- EC2 instances (managed by ASG) – HTTP
- ECS tasks (managed by ECS) – HTTP  
- Lambda functions – HTTP request → JSON event
- IP Addresses – must be private IPs

**NLB Target Groups:**
- EC2 instances
- IP Addresses (private IPs)
- Application Load Balancer

**GWLB Target Groups:**
- EC2 instances
- IP Addresses (private IPs)

## **Advanced Load Balancer Features**

### **Connection Draining**
**Feature Names:**
- **Connection Draining** (CLB)
- **Deregistration Delay** (ALB & NLB)

**Functionality:**
- Time to complete "in-flight requests" while instance is de-registering/unhealthy
- Stops sending **new requests** to de-registering instance
- **Range:** 1-3600 seconds (default: 300 seconds)
- **Can be disabled** (set to 0)
- **Best practice:** Set low value for short requests

### **Cross-Zone Load Balancing**

**Without Cross-Zone Load Balancing:**
- Requests distributed evenly among load balancer nodes
- **Uneven distribution** across actual instances

**With Cross-Zone Load Balancing:**
- Each load balancer instance distributes evenly across **all registered instances in all AZs**
- **Even distribution** across all instances

**Configuration by Load Balancer Type:**
- **ALB:** Enabled by default, no inter-AZ data charges
- **NLB & GWLB:** Disabled by default, pay for inter-AZ data if enabled
- **CLB:** Disabled by default, no charges for inter-AZ data if enabled

### **Sticky Sessions (Session Affinity)**
- Same client always redirected to **same instance**
- **Supported by:** CLB, ALB, NLB
- Uses **cookies** with expiration date
- **Use case:** Preserve user session data
- **Drawback:** May cause load imbalance

## **Auto Scaling Groups (ASG)**

### **What's an Auto Scaling Group?**

**Purpose:**
- **Scale out** (add EC2 instances) for increased load
- **Scale in** (remove EC2 instances) for decreased load
- **Ensure min/max** number of EC2 instances running
- **Automatically register** new instances to load balancer
- **Re-create instances** if terminated (unhealthy)
- **ASGs are free** (pay only for underlying EC2 instances)

### **ASG Attributes**

**Launch Template includes:**
- AMI + Instance Type
- EC2 User Data
- EBS Volumes
- Security Groups
- SSH Key Pair
- IAM Roles for EC2 Instances
- Network + Subnets Information
- Load Balancer Information
- **Capacity settings:** Min Size / Max Size / Initial Capacity
- **Scaling Policies**

### **Auto Scaling Policies**

**1. Dynamic Scaling:**

**Target Tracking Scaling:**
- **Simple to set up**
- Example: Keep average ASG CPU at ~40%

**Simple/Step Scaling:**
- Based on CloudWatch alarms
- Example: CPU > 70% → add 2 units
- Example: CPU < 30% → remove 1 unit

**2. Scheduled Scaling:**
- **Anticipate scaling** based on known usage patterns
- Example: Increase min capacity to 10 at 5 PM on Fridays

**3. Predictive Scaling:**
- **Continuously forecast load** and schedule scaling ahead

### **Good Metrics to Scale On**

**Common Metrics:**
- **CPUUtilization:** Average CPU across instances
- **RequestCountPerTarget:** Requests per EC2 instance (stable)
- **Average Network In/Out:** For network-bound applications
- **Custom metrics:** Pushed using CloudWatch

### **Auto Scaling Features**

**Scaling Cooldowns:**
- **Cooldown period:** Default 300 seconds after scaling activity
- **Purpose:** Allow metrics to stabilize
- **No additional launches/terminations** during cooldown
- **Best practice:** Use ready-to-use AMI to reduce cooldown

**Instance Refresh:**
- **Goal:** Update launch template and re-create all EC2 instances
- **Settings:** Minimum healthy percentage, warm-up time
- **Use case:** Deploy new AMI across all instances

## **Integration with Other AWS Services**

**Load Balancer Security Groups:**
- **Load Balancer SG:** Allow HTTP/HTTPS from anywhere
- **Application SG:** Allow traffic only from Load Balancer

**Route 53 Integration:**
- **Health checks** for failover routing
- **Latency-based routing** to closest healthy endpoint
- **Weighted routing** for gradual traffic shifting

**CloudWatch Integration:**
- **Metrics:** Monitor load balancer and target health
- **Alarms:** Trigger scaling actions
- **Custom metrics:** Enable advanced scaling decisions