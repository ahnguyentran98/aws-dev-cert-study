# Amazon S3 Security - Summary

## **S3 Security Model Overview**
- **User-Based Security**: IAM Policies control which API calls specific users can make
- **Resource-Based Security**: 
  - **Bucket Policies**: Bucket-wide rules allowing cross-account access
  - **Object ACL**: Finer-grained control (can be disabled)
  - **Bucket ACL**: Less common (can be disabled)
- **Access Rule**: Principal can access S3 object if IAM permissions OR resource policy allows it AND no explicit DENY exists

## **S3 Encryption Methods**

### **Server-Side Encryption (SSE)**
- **SSE-S3**: 
  - AWS-managed keys, AES-256 encryption
  - Enabled by default for new buckets/objects
  - Header: `"x-amz-server-side-encryption": "AES256"`

- **SSE-KMS**:
  - AWS KMS-managed keys with user control and audit trail
  - Header: `"x-amz-server-side-encryption": "aws:kms"`
  - **Limitation**: KMS quota limits (5,500-30,000 req/s depending on region)
  - **S3 Bucket Key**: Reduces KMS API calls by 99% and costs by 99%

- **SSE-C**:
  - Customer-provided keys managed outside AWS
  - S3 doesn't store the encryption key
  - **HTTPS mandatory**
  - Key must be provided in HTTP headers for every request

### **Client-Side Encryption**
- Data encrypted before sending to S3
- Customer manages keys and encryption/decryption process
- Uses Amazon S3 Client-Side Encryption Library

## **Encryption in Transit**
- **SSL/TLS** encryption for data in flight
- **HTTP Endpoint**: Non-encrypted
- **HTTPS Endpoint**: Encrypted (recommended)
- **Force HTTPS**: Use bucket policy with `aws:SecureTransport` condition
- **Note**: Bucket policies evaluated before default encryption

## **S3 Access Control Features**

### **Bucket Policies**
- **JSON-based policies** with Elements: Version, Statement, Effect, Principal, Action, Resource, Condition
- **Use Cases**:
  - Grant public access
  - Force encryption at upload
  - Cross-account access
  - IP address restrictions

### **Block Public Access Settings**
- **Account-level or bucket-level** settings to prevent data leaks
- Overrides bucket policies and ACLs
- Recommended to keep enabled unless public access is required

### **MFA Delete**
- **Requires MFA** for:
  - Permanently deleting object versions
  - Suspending versioning on bucket
- **Prerequisites**: Versioning must be enabled
- **Only root account** can enable/disable MFA Delete

## **S3 Access Management Tools**

### **Pre-Signed URLs**
- **Temporary access** to S3 objects (up to 7 days max)
- **Inherit permissions** of the user who generated the URL
- **Expiration Options**:
  - S3 Console: 1 min to 12 hours
  - AWS CLI: Configurable with `--expires-in` parameter
- **Use Cases**: Premium content access, temporary uploads, dynamic file sharing

### **S3 Access Points**
- **Simplify security management** at scale
- Each access point has **own DNS name and policy**
- **VPC Origin**: Restrict access to VPC only (requires VPC Endpoint)
- Better than complex bucket policies for multiple use cases

### **S3 Object Lambda**
- **Transform objects** during retrieval using Lambda functions
- **Use Cases**: 
  - PII redaction for analytics
  - Data format conversion (XML to JSON)
  - Dynamic image resizing and watermarking

## **CORS (Cross-Origin Resource Sharing)**
- **Web browser mechanism** for cross-origin requests
- **Origin**: Protocol + Domain + Port
- Required when S3 bucket receives requests from different domain
- Configure **Access-Control-Allow-Origin** headers
- Common exam topic for static website hosting scenarios

## **S3 Access Logging**
- **Audit all S3 access requests** (authorized and denied)
- Logs stored in **another S3 bucket** in same region
- **Warning**: Never set logging bucket as the monitored bucket (creates infinite loop)
- Log format documented for analysis tools

## **Security Best Practices**
- Enable versioning for data protection
- Use MFA Delete for critical buckets
- Implement least-privilege access with IAM policies
- Monitor access with CloudTrail and S3 access logs
- Use encryption (SSE-S3 by default, SSE-KMS for audit trail)
- Regular access review using Access Analyzer
- Never make buckets public unless absolutely necessary