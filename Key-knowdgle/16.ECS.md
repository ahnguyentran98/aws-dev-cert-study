# Amazon ECS Summary

## **Core Concepts**

**What is Amazon ECS?**
- ECS = Elastic Container Service
- AWS managed service to run Docker containers on AWS
- Launch ECS Tasks on ECS Clusters
- Two main launch types: EC2 and Fargate

## **Launch Types**

**EC2 Launch Type**
- You provision and maintain EC2 instances infrastructure
- Each EC2 instance runs ECS Agent to register in ECS Cluster
- AWS manages starting/stopping containers
- You manage the underlying EC2 instances

**Fargate Launch Type**
- Serverless container platform
- No infrastructure provisioning required
- No EC2 instances to manage
- Just create task definitions and AWS runs tasks based on CPU/RAM requirements
- Scale by increasing number of tasks

## **Task Definitions**

**Core Components**
- JSON metadata defining how to run Docker containers
- Contains image name, port bindings, memory/CPU requirements
- Environment variables and networking information
- IAM roles and logging configuration
- Can define up to 10 containers per task definition

## **IAM Roles Structure**

**EC2 Instance Profile (EC2 Launch Type only)**
- Used by ECS agent for API calls to ECS service
- Send container logs to CloudWatch
- Pull Docker images from ECR
- Access Secrets Manager or SSM Parameter Store

**ECS Task Role**
- Specific role for each task
- Different roles for different ECS services
- Defined in task definition
- Allows fine-grained permissions per service

## **Load Balancer Integration**

**Supported Types**
- **Application Load Balancer**: Recommended for most use cases
- **Network Load Balancer**: High throughput/performance or AWS PrivateLink
- **Classic Load Balancer**: Not recommended (limited features, no Fargate support)

**Load Balancing Behavior**
- **EC2 Launch Type**: Dynamic host port mapping, ALB finds correct ports
- **Fargate**: Each task gets unique private IP, only define container port

## **Data Storage Options**

**EFS (Elastic File System)**
- Works with both EC2 and Fargate launch types
- Multi-AZ shared storage for containers
- Persistent storage across availability zones
- Fargate + EFS = Serverless solution

**Bind Mounts**
- Share data between containers in same task definition
- **EC2 Tasks**: Uses EC2 instance storage
- **Fargate Tasks**: Ephemeral storage (20-200 GiB)
- Use case: Sidecar container pattern for logs/metrics

## **Auto Scaling**

**ECS Service Auto Scaling**
- Uses AWS Application Auto Scaling
- Metrics: CPU utilization, memory utilization, ALB request count per target
- Scaling types: Target tracking, step scaling, scheduled scaling

**EC2 Instance Scaling (EC2 Launch Type)**
- Auto Scaling Group scaling based on CPU utilization
- ECS Cluster Capacity Provider for automatic infrastructure provisioning

## **Task Placement (EC2 Launch Type Only)**

**Placement Strategies**
- **Binpack**: Minimize EC2 instances (cost savings)
- **Random**: Tasks placed randomly
- **Spread**: Even distribution based on specified values
- Can mix strategies together

**Placement Constraints**
- **distinctInstance**: Tasks on different EC2 instances
- **memberOf**: Tasks on instances satisfying specific expressions

**Placement Process**
1. Identify instances satisfying CPU/memory/port requirements
2. Check Task Placement Constraints
3. Apply Task Placement Strategies
4. Select instances

## **Environment Variables**

**Variable Types**
- **Hardcoded**: URLs and static values
- **SSM Parameter Store**: Sensitive variables (API keys, configs)
- **Secrets Manager**: Sensitive variables (DB passwords)
- **Environment Files**: Bulk variables from Amazon S3

## **Integration Patterns**

**Event-Driven Architectures**
- EventBridge integration for scheduled tasks
- SQS queue integration for message processing
- EventBridge monitoring for stopped tasks

**Rolling Updates**
- Control task start/stop during updates
- Configure minimum healthy percent and maximum percent
- Gradual deployment from v1 to v2