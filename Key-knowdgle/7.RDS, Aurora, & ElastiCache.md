## **Amazon RDS (Relational Database Service) Overview**

### **What is RDS?**
- **RDS = Relational Database Service**
- **Managed database service** for databases that use SQL as query language
- Allows creating databases in the cloud managed by AWS

### **Supported Database Engines:**
- **PostgreSQL**
- **MySQL** 
- **MariaDB**
- **Oracle**
- **Microsoft SQL Server**
- **IBM DB2**
- **Aurora** (AWS Proprietary database)

### **Advantages of RDS vs Deploying DB on EC2:**

**RDS Managed Service Benefits:**
- **Automated provisioning & OS patching**
- **Continuous backups** & restore to specific timestamp (Point in Time Restore)
- **Monitoring dashboards**
- **Read replicas** for improved read performance
- **Multi-AZ setup** for Disaster Recovery (DR)
- **Maintenance windows** for upgrades
- **Scaling capability** (vertical and horizontal)
- **Storage backed by EBS**

**Limitation:**
- **Cannot SSH into instances** (except RDS Custom)

## **RDS Key Features**

### **RDS Storage Auto Scaling**
**Functionality:**
- **Dynamically increases storage** on RDS DB instance
- **Automatic scaling** when running out of free database storage
- Avoids manual storage scaling

**Trigger Conditions:**
- Free storage < 10% of allocated storage
- Low-storage condition lasts ≥ 5 minutes  
- 6+ hours passed since last modification

**Configuration:**
- Must set **Maximum Storage Threshold**
- **Supports all RDS database engines**
- **Useful for unpredictable workloads**

### **RDS Read Replicas**

**Characteristics:**
- **Up to 15 Read Replicas** per database
- **Deployment options:** Within AZ, Cross AZ, or Cross Region
- **ASYNC replication** - reads are eventually consistent
- Replicas can be **promoted to their own DB**

**Use Cases:**
- **Production database** handles normal load
- **Read Replica** for reporting/analytics applications
- **Read-only operations** (SELECT statements)
- **Not for** INSERT, UPDATE, DELETE operations

**Network Cost Considerations:**
- **Same region:** Free replication (different AZs)
- **Cross-region:** Network costs apply ($$$)

### **RDS Multi-AZ (Disaster Recovery)**

**Core Features:**
- **SYNC replication** to standby instance in different AZ
- **One DNS name** - automatic application failover
- **Increases availability**
- **No manual intervention** required in applications
- **Not used for scaling** - only for availability

**Failover Triggers:**
- Loss of AZ, network, instance, or storage failure

**Migration Process (Single-AZ to Multi-AZ):**
- **Zero downtime operation**
- Snapshot taken → New DB restored → Synchronization established

## **Amazon Aurora**

### **Aurora Overview**
- **AWS proprietary technology** (not open source)
- **PostgreSQL and MySQL compatible** - existing drivers work
- **AWS cloud optimized** performance claims:
  - **5x performance** improvement over MySQL on RDS
  - **3x performance** improvement over PostgreSQL on RDS

### **Aurora Storage & Scaling**
- **Automatic storage growth:** 10GB increments up to **128 TB**
- **Up to 15 replicas** with faster replication than MySQL
- **Sub-10ms replica lag**
- **Instantaneous failover** - High Availability native
- **20% more cost** than RDS but more efficient

### **Aurora High Availability Architecture**

**Storage Distribution:**
- **6 copies of data across 3 AZs:**
  - **4 copies out of 6** needed for writes
  - **3 copies out of 6** needed for reads
- **Self-healing** with peer-to-peer replication
- **Storage striped** across 100s of volumes

**Instance Configuration:**
- **One Aurora Instance** handles writes (master)
- **Automated failover** for master in <30 seconds  
- **Master + up to 15 Aurora Read Replicas** serve reads
- **Cross Region Replication** supported

### **Aurora Endpoints**
- **Writer Endpoint:** Points to the master instance
- **Reader Endpoint:** Connection load balancing across read replicas

### **Aurora Features**
- **Automatic failover**
- **Backup and Recovery**
- **Isolation and security**
- **Industry compliance**
- **Push-button scaling**
- **Automated Patching with Zero Downtime**
- **Advanced Monitoring**
- **Routine Maintenance**
- **Backtrack:** Restore data at any point in time without using backups

## **RDS & Aurora Security**

### **Encryption:**
**At-rest Encryption:**
- Database master & replicas encryption using **AWS KMS**
- **Must be defined at launch time**
- If master not encrypted → read replicas cannot be encrypted
- **To encrypt un-encrypted DB:** Take snapshot & restore as encrypted

**In-flight Encryption:**
- **TLS-ready by default**
- Use AWS TLS root certificates client-side

### **Access Control:**
- **IAM Authentication:** IAM roles to connect (instead of username/password)
- **Security Groups:** Control network access to RDS/Aurora DB
- **No SSH available** (except RDS Custom)
- **Audit Logs:** Can be enabled and sent to CloudWatch Logs

## **Amazon RDS Proxy**

### **Purpose & Benefits:**
- **Fully managed database proxy** for RDS
- **Allows apps to pool and share DB connections**
- **Improves database efficiency** by reducing stress on resources (CPU, RAM)
- **Minimizes open connections** and timeouts

### **Characteristics:**
- **Serverless, autoscaling, highly available** (multi-AZ)
- **Reduced failover time by up to 66%**
- **Supports:** RDS (MySQL, PostgreSQL, MariaDB, MS SQL Server) and Aurora
- **No code changes** required for most apps
- **Enforce IAM Authentication** and securely store credentials in Secrets Manager
- **Never publicly accessible** - must be accessed from VPC

## **Amazon ElastiCache**

### **ElastiCache Overview**
- **Managed Redis or Memcached** service
- **In-memory databases** with high performance, low latency
- **Same relationship** as RDS is to relational databases

### **Benefits:**
- **Reduces load** off databases for read-intensive workloads
- **Helps make applications stateless**
- **AWS manages:** OS maintenance, patching, optimizations, setup, configuration, monitoring, failure recovery, and backups

### **Important Consideration:**
- **Using ElastiCache involves heavy application code changes**

## **ElastiCache Solution Architectures**

### **1. DB Cache Pattern:**
**Flow:**
1. Application queries ElastiCache
2. **Cache hit:** Return data from cache
3. **Cache miss:** Get from RDS → Store in ElastiCache → Return data

**Benefits:**
- **Relieves load on RDS**
- **Cache invalidation strategy** needed for current data

### **2. User Session Store:**
**Flow:**
1. User logs into any application instance
2. Application writes session data to ElastiCache  
3. User hits different application instance
4. Instance retrieves session data → User already logged in

**Benefits:**
- **Stateless applications**
- **Session persistence** across instances

## **ElastiCache: Redis vs Memcached**

### **Redis Features:**
- **Multi-AZ with Auto-Failover**
- **Read Replicas** for scaling reads and high availability
- **Data Durability** using AOF persistence
- **Backup and restore features**
- **Advanced data structures:** Sets and Sorted Sets
- **Replication supported**

### **Memcached Features:**
- **Multi-node** for data partitioning (sharding)
- **No high availability** (no replication)
- **Non-persistent** storage
- **No backup and restore**
- **Multi-threaded architecture**
- **Simple caching use cases**

## **Caching Implementation Considerations**

### **Key Questions:**
**1. Is it safe to cache data?**
- Data may be out of date (eventually consistent)

**2. Is caching effective for that data?**
- **Good pattern:** Data changing slowly, few keys frequently needed
- **Anti-pattern:** Data changing rapidly, large key space frequently needed

**3. Is data structured well for caching?**
- Consider data access patterns and structure

### **When to Use Each Technology:**

| Use Case | Recommended Technology | Reason |
|----------|----------------------|---------|
| **Relational data, ACID transactions** | **RDS** | Full SQL support, consistency |
| **High performance, cloud-optimized relational** | **Aurora** | Better performance, cloud-native |
| **Fast access to frequently read data** | **ElastiCache** | In-memory speed |
| **Session storage** | **ElastiCache** | Stateless applications |
| **Complex data structures, persistence** | **Redis** | Advanced features, durability |
| **Simple caching, multi-threaded** | **Memcached** | High throughput, simplicity |

## **Cost Considerations**

- **RDS:** Standard managed database costs
- **Aurora:** 20% more than RDS but more efficient
- **ElastiCache:** Pay for cache nodes and data transfer
- **Read Replicas:** 
  - Same region: Free data transfer
  - Cross-region: Network charges apply