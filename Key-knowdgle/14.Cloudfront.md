# Amazon CloudFront - Summary

## **CloudFront Overview**
- **Content Delivery Network (CDN)** that improves read performance by caching content at edge locations
- **216 Point of Presence globally** (edge locations)
- **Benefits**: Improved user experience, DDoS protection, integration with Shield and AWS WAF
- **Use Cases**: Static content distribution, API acceleration, live streaming

## **CloudFront Origins**

### **S3 Bucket as Origin**
- Distribute files and cache them at the edge
- **Origin Access Control (OAC)**: Enhanced security (replacing OAI)
- Can be used as ingress to upload files to S3
- Must configure S3 bucket policy to allow OAC access

### **Custom HTTP Origins**
- **Application Load Balancer**
- **EC2 instances** (must be public with security group allowing CloudFront IPs)
- **S3 static website** (different from S3 bucket origin)
- **Any HTTP backend**

## **CloudFront Caching**

### **Cache Key**
- **Default**: Hostname + resource portion of URL
- **Customizable**: Can include HTTP headers, cookies, query strings
- Used to uniquely identify cached objects at edge locations

### **Cache Policies**
- **HTTP Headers**: None, Whitelist (best performance with "None")
- **Cookies**: None, Whitelist, Include All-Except, All
- **Query Strings**: None, Whitelist, Include All-Except, All (worst performance with "All")
- **TTL Control**: 0 seconds to 1 year, controlled by Cache-Control or Expires headers

### **Origin Request Policy**
- Include data in origin requests **without** adding to cache key
- Prevents cache duplication while forwarding necessary data to origin
- Can add CloudFront headers and custom headers

## **Cache Management**
- **Cache Invalidation**: Force refresh using CreateInvalidation API
  - Can invalidate all files (*) or specific paths (/images/*)
  - Bypasses TTL for immediate updates
- **Maximize Cache Hits**: Separate static and dynamic distributions

## **CloudFront Behaviors & Routing**
- **Cache Behaviors**: Configure different settings for URL path patterns
  - Route to different origins based on content type
  - Examples: /images/*, /api/*, /* (default)
- **Multiple Origins**: Route based on path patterns
- **Origin Groups**: High availability with primary/secondary failover

## **CloudFront vs S3 Cross Region Replication**
- **CloudFront**: Global edge network, cached for TTL, great for static content everywhere
- **S3 CRR**: Near real-time updates, read-only, great for dynamic content in few regions

## **Security Features**

### **Geo Restriction**
- **Allowlist**: Allow access only from approved countries
- **Blocklist**: Block access from banned countries
- Uses 3rd party Geo-IP database for country determination

### **Signed URLs & Signed Cookies**
- **Use Case**: Distribute paid/premium content
- **Policy includes**: URL expiration, IP ranges, trusted signers
- **Signed URL**: Access to individual files
- **Signed Cookies**: Access to multiple files
- **Two signer types**: Trusted key groups (recommended) or AWS account with CloudFront key pair

### **CloudFront vs S3 Pre-signed URLs**
- **CloudFront**: Path-based access, account-wide key-pair, caching benefits, IP/date filtering
- **S3**: Direct S3 access, uses IAM key, limited lifetime, no caching

## **Edge Functions**

### **CloudFront Functions**
- **Language**: JavaScript only
- **Performance**: Sub-ms startup, millions of requests/second
- **Memory**: 2MB max
- **Triggers**: Viewer Request/Response only
- **Use Cases**: Cache key normalization, header manipulation, URL rewrites, authentication

### **Lambda@Edge**
- **Languages**: Node.js, Python
- **Performance**: 5-10 seconds execution, thousands of requests/second
- **Memory**: 128MB up to 10GB
- **Triggers**: All four points (Viewer + Origin Request/Response)
- **Features**: Network access, file system access, access to request body
- **Use Cases**: Complex processing, 3rd party libraries, external service calls

## **Advanced Features**
- **Field Level Encryption**: Encrypt sensitive form fields at edge using asymmetric encryption
- **Real-time Logs**: Send request logs to Kinesis Data Streams for monitoring and analysis
- **Price Classes**: Control edge location usage for cost optimization
  - Price Class All (best performance)
  - Price Class 200 (excludes most expensive regions)
  - Price Class 100 (least expensive regions only)

## **Best Practices**
- Use separate distributions for static vs dynamic content
- Configure appropriate cache policies to maximize cache hits
- Implement Origin Access Control for S3 origins
- Use CloudFront Functions for simple, high-scale customizations
- Use Lambda@Edge for complex processing requirements
- Monitor performance with CloudWatch and real-time logs