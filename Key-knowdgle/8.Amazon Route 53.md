## **DNS & Route 53 Overview**

### **What is DNS?**
- **Domain Name System** translates human-friendly hostnames into machine IP addresses
- Example: www.google.com → 172.217.18.36
- **DNS is the backbone of the Internet**
- Uses **hierarchical naming structure**

### **DNS Terminologies**
- **Domain Registrar:** Amazon Route 53, GoDaddy, etc.
- **DNS Records:** A, AAAA, CNAME, NS, etc.
- **Zone File:** Contains DNS records
- **Name Server:** Resolves DNS queries (Authoritative or Non-Authoritative)
- **Top Level Domain (TLD):** .com, .us, .in, .gov, .org
- **Second Level Domain (SLD):** amazon.com, google.com
- **FQDN:** Fully Qualified Domain Name

### **Amazon Route 53 Overview**
- **Highly available, scalable, fully managed and Authoritative DNS**
- **Authoritative = customer can update DNS records**
- **Also functions as Domain Registrar**
- **Ability to check health of resources**
- **Only AWS service with 100% availability SLA**
- **Why Route 53?** Reference to traditional DNS port 53

## **Route 53 Core Components**

### **DNS Records Structure**
Each record contains:
- **Domain/subdomain Name** (e.g., example.com)
- **Record Type** (e.g., A or AAAA)
- **Value** (e.g., 12.34.56.78)
- **Routing Policy** (how Route 53 responds to queries)
- **TTL** (Time To Live - caching duration at DNS Resolvers)

### **DNS Record Types**

**Must Know Record Types:**
- **A Record:** Maps hostname to IPv4
- **AAAA Record:** Maps hostname to IPv6
- **CNAME Record:** Maps hostname to another hostname
  - Target must have A or AAAA record
  - **Cannot create for Zone Apex** (e.g., can't use for example.com, but can for www.example.com)
- **NS Record:** Name Servers for Hosted Zone - controls traffic routing

**Advanced Record Types:**
- CAA, DS, MX, NAPTR, PTR, SOA, TXT, SPF, SRV

## **Hosted Zones**

### **Definition:**
- **Container for records** defining traffic routing to domain and subdomains

### **Types of Hosted Zones:**

**1. Public Hosted Zones:**
- Contains records for **routing Internet traffic** (public domain names)
- Example: application1.mypublicdomain.com

**2. Private Hosted Zones:**
- Contains records for **routing traffic within VPCs** (private domain names)
- Example: application1.company.internal
- Resources accessible only within specified VPCs

**Cost:** $0.50 per month per hosted zone

## **TTL (Time To Live)**

### **How TTL Works:**
- Determines **how long DNS records are cached** at DNS Resolvers
- Client caches result for the TTL duration

### **TTL Considerations:**

**High TTL (e.g., 24 hours):**
- **Less traffic** on Route 53 (cost savings)
- **Possibly outdated records**
- Slower to reflect changes

**Low TTL (e.g., 60 seconds):**
- **More traffic** on Route 53 (higher cost)
- **Records outdated for less time**
- **Easy to change records** quickly

**Important:** TTL is **mandatory for each DNS record except Alias records**

## **CNAME vs Alias Records**

### **CNAME Records:**
- Points hostname to **any other hostname**
- **Only for NON-ROOT DOMAIN** (e.g., something.mydomain.com)
- Example: app.mydomain.com → blabla.anything.com

### **Alias Records:**
- Points hostname to **AWS Resource**
- **Works for ROOT DOMAIN and NON-ROOT DOMAIN** (mydomain.com)
- **Free of charge**
- **Native health check** capability
- **Extension to DNS functionality**
- **Always type A/AAAA** for AWS resources
- **Cannot set TTL** (AWS managed)
- **Automatically recognizes IP address changes**

### **Alias Record Targets:**
✅ **Supported:**
- Elastic Load Balancers
- CloudFront Distributions
- API Gateway
- Elastic Beanstalk environments
- S3 Websites
- VPC Interface Endpoints
- Global Accelerator
- Route 53 record in same hosted zone

❌ **Not Supported:**
- EC2 DNS names

## **Route 53 Routing Policies**

### **Important Note:**
- **DNS does not route traffic** - only responds to DNS queries
- **Different from Load Balancer routing**

### **Available Routing Policies:**

## **1. Simple Routing Policy**

**Characteristics:**
- Route traffic to **single resource** typically
- Can specify **multiple values in same record**
- If multiple values returned, **client chooses random one**
- When Alias enabled, **specify only one AWS resource**
- **Cannot be associated with Health Checks**

## **2. Weighted Routing Policy**

**Functionality:**
- **Control percentage** of requests to each resource
- **Formula:** traffic(%) = weight for specific record / sum of all weights for all records

**Features:**
- **Weights don't need to sum to 100**
- DNS records must have **same name and type**
- **Can be associated with Health Checks**
- **Assign weight 0** to stop sending traffic to resource
- **If all weights are 0**, all records returned equally

**Use Cases:**
- Load balancing between regions
- Testing new application versions

## **3. Latency-based Routing Policy**

**Functionality:**
- **Redirect to resource with least latency** close to user
- **Latency based on traffic between users and AWS Regions**
- Example: Germany users may be directed to US if lowest latency

**Features:**
- **Super helpful when latency is priority**
- **Can be associated with Health Checks** (failover capability)

## **4. Failover Routing Policy (Active-Passive)**

**Setup:**
- **Primary resource** (mandatory health check)
- **Secondary resource** (Disaster Recovery)
- **Automatic failover** when primary fails health check

## **5. Geolocation Routing Policy**

**Functionality:**
- **Routing based on user location**
- **Different from Latency-based routing**
- Specify location by **Continent, Country, or US State**
- **Most precise location selected** if overlapping
- **Must create "Default" record** for no location match

**Use Cases:**
- Website localization
- Restrict content distribution
- Load balancing
- **Can be associated with Health Checks**

## **6. Geoproximity Routing Policy**

**Functionality:**
- Route traffic based on **geographic location of users and resources**
- **Ability to shift traffic** using defined **bias**

**Bias Values:**
- **Expand (1 to 99):** More traffic to resource
- **Shrink (-1 to -99):** Less traffic to resource

**Resource Types:**
- **AWS resources:** Specify AWS region
- **Non-AWS resources:** Specify Latitude and Longitude

**Requirement:** Must use **Route 53 Traffic Flow**

## **7. IP-based Routing Policy**

**Functionality:**
- **Routing based on clients' IP addresses**
- Provide **CIDR list for clients** with corresponding endpoints
- **User-IP-to-endpoint mappings**

**Use Cases:**
- Optimize performance
- Reduce network costs
- Route users from particular ISP to specific endpoint

## **8. Multi-Value Answer Routing Policy**

**Functionality:**
- Route traffic to **multiple resources**
- Route 53 returns **multiple values/resources**
- **Can be associated with Health Checks** (only healthy resources returned)
- **Up to 8 healthy records** returned per query
- **Not a substitute for ELB**

## **Route 53 Health Checks**

### **Types of Health Checks:**

**1. Monitor an Endpoint:**
- **About 15 global health checkers** check endpoint health
- **Healthy/Unhealthy Threshold:** 3 (default)
- **Interval:** 30 sec (can set to 10 sec - higher cost)
- **Supported protocols:** HTTP, HTTPS, TCP
- **>18% of health checkers report healthy** → Route 53 considers Healthy

**Health Check Requirements:**
- **2xx and 3xx status codes** for success
- Can check **text in first 5120 bytes** of response
- **Must allow Route 53 Health Checker IP ranges**
- **HTTP Health Checks only for public resources**

**2. Calculated Health Checks:**
- **Combine multiple Health Checks** into single Health Check
- **Logical operators:** OR, AND, NOT
- **Monitor up to 256 Child Health Checks**
- **Specify how many need to pass** for parent to pass
- **Use case:** Website maintenance without all health checks failing

**3. Monitor CloudWatch Alarms:**
- **Full control** over health checking
- Monitor **DynamoDB throttles, RDS alarms, custom metrics**
- **Helpful for private resources**
- **Health Checks integrated with CloudWatch metrics**

### **Health Checks for Private Resources:**
- **Route 53 health checkers are outside VPC**
- **Cannot access private endpoints**
- **Solution:** Create CloudWatch Metric → CloudWatch Alarm → Health Check monitors alarm

## **Route 53 Traffic Flow**

**Features:**
- **Visual editor** for complex routing decision trees
- **Simplify large and complex configurations**
- **Save configurations as Traffic Flow Policy**
- **Apply to different Hosted Zones** (different domains)
- **Supports versioning**

## **Domain Registrar vs DNS Service**

### **Key Concepts:**
- **Domain Registrar ≠ DNS Service**
- **Domain Registrar:** Where you buy/register domain (GoDaddy, Amazon Registrar Inc.)
- **DNS Service:** Manages DNS records (can be different from registrar)

### **Using Third-Party Registrar with Route 53:**
1. **Create Hosted Zone in Route 53**
2. **Update NS Records** on third-party website to use Route 53 Name Servers
3. **Route 53 becomes DNS Service provider**

### **Benefits:**
- **Leverage Route 53's advanced features** while keeping existing registrar
- **Centralized DNS management** in AWS ecosystem

## **Route 53 Integration with AWS Services**

### **Load Balancer Integration:**
- **Alias records** point to Load Balancers
- **Health checks** enable automatic failover
- **Weighted routing** for gradual traffic shifting

### **Use Cases:**
- **Blue-Green Deployments** with Elastic Beanstalk
- **Canary testing** with traffic splitting
- **Multi-region active-active** architectures
- **Disaster recovery** with failover routing

## **Best Practices & Considerations**

### **Routing Policy Selection:**
- **Simple:** Single resource, no health checks needed
- **Weighted:** Load balancing, testing new versions
- **Latency-based:** Performance-critical applications
- **Failover:** Active-passive disaster recovery
- **Geolocation:** Location-based content/compliance
- **Geoproximity:** Fine-tuned geographic control
- **Multi-Value:** Multiple resources with health checks

### **Cost Optimization:**
- **Higher TTL** reduces Route 53 query costs
- **Alias records** are free vs CNAME charges
- **Health check frequency** affects costs

### **Performance Optimization:**
- **Latency-based routing** for best user experience
- **Health checks** ensure traffic only to healthy resources
- **Multiple routing policies** can be combined