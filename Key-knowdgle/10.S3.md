
## **Amazon S3 Overview**

### **What is Amazon S3?**
- **Simple Storage Service** - object storage service
- **Global service appearance** but buckets are created in specific regions
- **Allows storing and retrieving any amount of data** from anywhere on the web
- **Highly scalable, reliable, and low-latency** data storage infrastructure

## **S3 Core Concepts**

### **Buckets**
**Definition:** Containers for objects (files) in Amazon S3

**Key Characteristics:**
- **Globally unique naming** across all regions and accounts
- **Defined at region level** despite global appearance
- **Act as top-level directories**

**Naming Conventions:**
- **No uppercase letters, no underscores**
- **3-63 characters long**
- **Not an IP address**
- **Must start with lowercase letter or number**
- **Must NOT start with prefix `xn--`**
- **Must NOT end with suffix `-s3alias`**

### **Objects**
**Definition:** Files stored in S3 buckets

**Key Components:**
- **Key:** Full path to the object
  - Example: `s3://my-bucket/my_folder1/another_folder/my_file.txt`
  - Key = prefix + object name
- **Value:** Content of the body
- **Version ID:** If versioning is enabled
- **Metadata:** Key-value pairs (system or user metadata)
- **Tags:** Unicode key-value pairs (up to 10) for security/lifecycle

**Size Limitations:**
- **Maximum object size:** 5TB (5,000GB)
- **Multi-part upload required** for files > 5GB
- **Multi-part upload recommended** for files > 100MB

**Important:** No concept of "directories" - just keys with long names containing slashes

## **S3 Security**

### **Security Model Overview**
**Two Main Types:**

**1. User-Based Security:**
- **IAM Policies:** Define which API calls allowed for specific IAM users

**2. Resource-Based Security:**
- **Bucket Policies:** Bucket-wide rules from S3 console (allows cross-account)
- **Object Access Control List (ACL):** Finer grain control (can be disabled)
- **Bucket Access Control List (ACL):** Less common (can be disabled)

### **Access Evaluation Logic**
**IAM principal can access S3 object if:**
- User IAM permissions ALLOW it **OR** resource policy ALLOWS it
- **AND** there's no explicit DENY

### **S3 Bucket Policies**
**Characteristics:**
- **JSON-based policies**
- **Components:** Resources, Effect (Allow/Deny), Actions, Principal

**Common Use Cases:**
- Grant public access to bucket
- Force object encryption at upload
- Grant cross-account access

### **Security Use Cases Examples**

| Scenario | Security Method |
|----------|----------------|
| **Public Website Access** | Bucket Policy (Allow public access) |
| **IAM User Access** | IAM Policy attached to user |
| **EC2 Instance Access** | IAM Role with appropriate permissions |
| **Cross-Account Access** | Bucket Policy allowing other AWS account |

### **Block Public Access Settings**
- **Prevents company data leaks**
- **Can be set at account level**
- **Leave enabled if bucket should never be public**

## **S3 Encryption**

### **Server-Side Encryption Options**

**1. SSE-S3 (Default):**
- **Automatically applied** to new objects
- **AWS-managed keys**
- **AES-256 encryption**

**2. SSE-KMS:**
- **AWS KMS managed keys**
- **More control over key usage**
- **Audit trail through CloudTrail**

**3. SSE-C:**
- **Customer-provided keys**
- **HTTPS must be used**
- **Customer manages encryption keys**
- **Key must be provided in HTTP headers for every request**

**4. Client-Side Encryption:**
- **Customer encrypts data before sending to S3**
- **Customer manages entire encryption/decryption process**
- **Use AWS S3 Client-Side Encryption Library**

### **Encryption in Transit**
- **SSL/TLS encryption**
- **Two endpoints available:**
  - HTTP Endpoint (non-encrypted)
  - HTTPS Endpoint (encrypted) - **Recommended**
- **HTTPS mandatory for SSE-C**

### **Default Encryption vs Bucket Policies**
- **SSE-S3 automatically applied** to new objects
- **Bucket Policies evaluated before Default Encryption**
- Can force encryption using bucket policy

## **S3 Versioning**

### **Key Features**
- **Enabled at bucket level**
- **Same key overwrite creates new version** (1, 2, 3...)
- **Best practice for protecting against unintended deletes**
- **Easy rollback to previous versions**

### **Important Notes**
- **Files not versioned before enabling** have version "null"
- **Suspending versioning doesn't delete** previous versions
- **Can delete specific versions** or use lifecycle policies

## **S3 Replication**

### **Prerequisites**
- **Must enable versioning** in source and destination buckets
- **Must provide proper IAM permissions** to S3

### **Types**

**Cross-Region Replication (CRR):**
- **Use cases:** Compliance, lower latency access, cross-account replication

**Same-Region Replication (SRR):**
- **Use cases:** Log aggregation, production/test replication

### **Key Characteristics**
- **Asynchronous copying**
- **Buckets can be in different AWS accounts**
- **Only new objects replicated** after enabling
- **Use S3 Batch Replication** for existing objects
- **No "chaining" of replication**

### **Deletion Behavior**
- **Can replicate delete markers** (optional setting)
- **Version ID deletions not replicated** (prevents malicious deletes)

## **S3 Storage Classes**

### **Durability and Availability**
**Durability:** 99.999999999% (11 9's) across all storage classes
**Availability:** Varies by storage class

### **Storage Classes Overview**

**1. S3 Standard - General Purpose:**
- **99.99% availability**
- **Frequently accessed data**
- **Low latency, high throughput**
- **Sustains 2 concurrent facility failures**
- **Use cases:** Big Data analytics, mobile & gaming applications

**2. S3 Standard-Infrequent Access (IA):**
- **99.9% availability**
- **Lower cost than Standard**
- **30-day minimum storage duration**
- **Use cases:** Disaster recovery, backups

**3. S3 One Zone-Infrequent Access:**
- **99.5% availability**
- **Single AZ storage** (data lost when AZ destroyed)
- **Lower cost than Standard-IA**
- **Use cases:** Secondary backup copies, recreatable data

**4. S3 Glacier Instant Retrieval:**
- **Millisecond retrieval**
- **90-day minimum storage duration**
- **Use cases:** Data accessed once a quarter**

**5. S3 Glacier Flexible Retrieval:**
- **Retrieval options:**
  - Expedited (1-5 minutes)
  - Standard (3-5 hours)
  - Bulk (5-12 hours) - free
- **90-day minimum storage duration**

**6. S3 Glacier Deep Archive:**
- **Long-term storage** (lowest cost)
- **Retrieval options:**
  - Standard (12 hours)
  - Bulk (48 hours)
- **180-day minimum storage duration**

**7. S3 Intelligent-Tiering:**
- **Automatic tiering** based on access patterns
- **No retrieval charges**
- **Small monthly monitoring fee**
- **Access tiers:**
  - Frequent Access (default)
  - Infrequent Access (30 days)
  - Archive Instant Access (90 days)
  - Archive Access (90-700+ days)
  - Deep Archive Access (180-700+ days)

### **Storage Classes Comparison Table**

| Storage Class | Availability | Min Storage Duration | Min Object Size | Use Case |
|---------------|--------------|---------------------|-----------------|----------|
| **Standard** | 99.99% | None | None | Frequently accessed |
| **Standard-IA** | 99.9% | 30 days | 128 KB | Disaster recovery |
| **One Zone-IA** | 99.5% | 30 days | 128 KB | Secondary backups |
| **Glacier Instant** | 99.9% | 90 days | 128 KB | Quarterly access |
| **Glacier Flexible** | 99.99% | 90 days | 40 KB | Archive with hours retrieval |
| **Glacier Deep Archive** | 99.99% | 180 days | 40 KB | Long-term archive |

## **S3 Lifecycle Management**

### **Lifecycle Rules**
**Two Types of Actions:**

**1. Transition Actions:**
- Move objects between storage classes
- Example: Standard → Standard-IA after 60 days → Glacier after 6 months

**2. Expiration Actions:**
- Delete objects after specified time
- Delete old versions (if versioning enabled)
- Delete incomplete multi-part uploads

### **Rule Configuration**
- **Prefix-based:** Apply to specific prefixes (s3://mybucket/mp3/*)
- **Tag-based:** Apply to objects with specific tags (Department: Finance)

### **S3 Analytics - Storage Class Analysis**
- **Helps decide when to transition** objects to right storage class
- **Recommendations for Standard and Standard-IA** only
- **Daily updated reports**
- **24-48 hours to start seeing data**
- **Good first step** for lifecycle rule creation

## **S3 Event Notifications**

### **Event Types**
- **S3:ObjectCreated, S3:ObjectRemoved, S3:ObjectRestore, S3:Replication**
- **Object name filtering** possible (*.jpg)

### **Destination Options**

**Standard Destinations:**
- **Lambda Functions**
- **SQS Queues**
- **SNS Topics**

**EventBridge Integration:**
- **All events** go to EventBridge
- **Advanced filtering** with JSON rules
- **18+ AWS services** as destinations
- **EventBridge capabilities:** Archive, Replay, Reliable delivery

### **IAM Permissions Required**
- **Lambda Resource Policy**
- **SNS Resource Policy**
- **SQS Resource Policy**

### **Delivery Characteristics**
- **Typically deliver in seconds**
- **Can sometimes take a minute or longer**

## **S3 Performance Optimization**

### **Baseline Performance**
- **Latency:** 100-200ms
- **Request rates per prefix:**
  - **3,500 PUT/COPY/POST/DELETE** per second
  - **5,500 GET/HEAD** per second
- **No limit on number of prefixes**

### **Performance Optimization Techniques**

**1. Multi-Part Upload:**
- **Recommended for files > 100MB**
- **Required for files > 5GB**
- **Parallelizes uploads** for faster transfers
- **Compatible with Transfer Acceleration**

**2. Transfer Acceleration:**
- **Uses AWS edge locations** for faster uploads
- **File transferred to edge location** → forwarded to target S3 bucket
- **Compatible with multi-part upload**

**3. Byte-Range Fetches:**
- **Parallelize downloads** by requesting specific byte ranges
- **Better resilience** in case of failures
- **Can retrieve partial data** (e.g., file headers)
- **Speed up downloads** through parallel requests

**4. S3 Select & Glacier Select:**
- **Server-side filtering** using SQL
- **Filter by rows & columns**
- **Reduces network transfer and CPU costs**
- **Works with CSV, JSON, Parquet files**

## **S3 Advanced Features**

### **Pre-Signed URLs**
**Purpose:** Provide temporary access to S3 objects

**Generation Methods:**
- **S3 Console:** 1 minute to 720 minutes (12 hours)
- **AWS CLI:** Configure with --expires-in parameter (default 3600 sec, max 604800 sec)
- **SDK:** Programmatic generation

**Use Cases:**
- **Temporary download access** for premium content
- **Temporary upload access** to specific location
- **User inherits permissions** of URL generator

### **Access Points**
**Purpose:** Simplify security management for S3 buckets

**Features:**
- **Own DNS name** (Internet or VPC origin)
- **Access point policy** (similar to bucket policy)
- **Scale security management**

**VPC Origin Access Points:**
- **Accessible only from within VPC**
- **Requires VPC Endpoint** (Gateway or Interface)
- **VPC Endpoint Policy** must allow access

### **Object Lambda**
**Purpose:** Transform objects on-the-fly using Lambda functions

**Use Cases:**
- **Redact PII** for analytics/non-production
- **Convert data formats** (XML to JSON)
- **Resize and watermark images** dynamically
- **User-specific object modifications**

### **CORS (Cross-Origin Resource Sharing)**
**When needed:** Client makes cross-origin requests to S3 bucket

**Configuration:**
- **Enable correct CORS headers**
- **Popular exam question**
- **Allow specific origin or * (all origins)**

**Example:** Static website in one S3 bucket accessing assets in another S3 bucket

### **MFA Delete**
**Purpose:** Add security layer for critical operations

**MFA Required for:**
- **Permanently delete object version**
- **Suspend versioning** on bucket

**MFA NOT Required for:**
- Enable versioning
- List deleted versions

**Prerequisites:**
- **Versioning must be enabled**
- **Only bucket owner (root account)** can enable/disable MFA Delete

### **Access Logs**
**Purpose:** Audit S3 bucket access

**Features:**
- **Log all requests** (authorized or denied)
- **Any account access** logged
- **Target logging bucket** must be in same region
- **Data analyzable** with analysis tools

**Warning:** Never set logging bucket as monitored bucket (creates infinite loop)

### **Static Website Hosting**
**Features:**
- **Host static websites** accessible on Internet
- **URL formats:**
  - `http://bucket-name.s3-website-aws-region.amazonaws.com`
  - `http://bucket-name.s3-website.aws-region.amazonaws.com`

**Troubleshooting:**
- **403 Forbidden error:** Check bucket policy allows public reads

## **S3 Integration with AWS Services**

### **DynamoDB Integration**
- **Store large objects in S3**, metadata in DynamoDB
- **S3 Object Lambda** for dynamic transformations
- **Event-driven processing** with Lambda functions

### **CloudFront Integration**
- **S3 as origin** for content delivery
- **Origin Access Control (OAC)** for security
- **Cache static content** globally

### **Lambda Integration**
- **Event-driven processing**
- **Object transformations**
- **Thumbnail generation**
- **Data processing pipelines**

## **Cost Optimization Best Practices**

### **Storage Class Strategy**
- **Lifecycle policies** for automatic transitions
- **Intelligent-Tiering** for unpredictable access patterns
- **Analytics** to inform lifecycle decisions

### **Request Optimization**
- **Use appropriate storage class** for access patterns
- **Implement caching** strategies
- **Optimize transfer methods** (multi-part, Transfer Acceleration)

### **Data Transfer Optimization**
- **Use Transfer Acceleration** for global uploads
- **CloudFront** for global content delivery
- **Byte-range fetches** for partial downloads
- **S3 Select** for filtered data retrieval
